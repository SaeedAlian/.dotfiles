#!/bin/sh

DIRECTORIES="$HOME/projects"

if [ $# -eq 1 ]; then
  selected_dir=$1
else
  find_res=$(find $DIRECTORIES -mindepth 1 -maxdepth 1 -type d)
  declare -a dirs=()
  for f in $find_res; do
    dirs+=("$f")
  done
  dirs+=("$HOME/.dotfiles")
  dirs+=("$HOME/.config")
  dirs+=("$HOME/documents/notes")
  dirs+=("$HOME/downloads/telegram")
  selected_dir=$(printf "%s\n" "${dirs[@]}" | fzf --wrap --wrap-sign=" ")
fi

selected_dir_basename=$(basename "$selected_dir")
selected_dir_basename="${selected_dir_basename//./}"

if [ -n "$selected_dir" ]; then
  if ! tmux has-session -t="$selected_dir_basename" 2>/dev/null; then
    tmux new-session -ds "$selected_dir_basename" -c "$selected_dir"
  fi

  if [ -z "$TMUX" ]; then
    tmux attach -t "$selected_dir_basename"
  else
    tmux switch-client -t "$selected_dir_basename"
  fi
else
  exit 0
fi
